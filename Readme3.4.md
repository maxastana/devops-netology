Задача 1
1. На лекции мы познакомились с node_exporter. В демонстрации его исполняемый файл запускался в background. Этого достаточно для демо, но не для настоящей production-системы, где процессы должны находиться под внешним управлением. Используя знания из лекции по systemd, создайте самостоятельно простой unit-файл для node_exporter:
- поместите его в автозагрузку,
- предусмотрите возможность добавления опций к запускаемому процессу через внешний файл (посмотрите, например, на systemctl cat cron),
- удостоверьтесь, что с помощью systemctl процесс корректно стартует, завершается, а после перезагрузки автоматически поднимается.

![image](https://user-images.githubusercontent.com/65549218/144737437-94b2dfed-6302-40bd-a984-c5cde02103bd.png)

![image](https://user-images.githubusercontent.com/65549218/144737448-5fed59ef-1b48-4659-b6b5-a7ed1fbfd0be.png)

![image](https://user-images.githubusercontent.com/65549218/144243329-d216175c-9913-4453-810b-64ec3eadef56.png)

Проверка службы
Рестарт, статус, стоп, старт, статус
![image](https://user-images.githubusercontent.com/65549218/144244409-3ccc6cf0-df81-4a54-ac4a-966ed04e2a10.png)
_________________________________________________________________________________________________________________________________________________________________________________

Задача 2

Ознакомьтесь с опциями node_exporter и выводом /metrics по-умолчанию. Приведите несколько опций, которые вы бы выбрали для базового мониторинга хоста по CPU, памяти, диску и сети.

Ответ:

				CPU
	node_cpu_seconds_total{cpu="0",mode="idle"} 18223.66
	node_cpu_seconds_total{cpu="0",mode="system"} 6.65
	node_cpu_seconds_total{cpu="0",mode="user"} 10.05
	node_cpu_seconds_total{cpu="1",mode="idle"} 18043.79
	node_cpu_seconds_total{cpu="1",mode="system"} 5.27
	node_cpu_seconds_total{cpu="1",mode="user"} 8.57
	
				Memory
	node_memory_MemAvailable_bytes 
        node_memory_MemFree_bytes
	
				Disk		
	node_disk_io_time_seconds_total{device="sda"} 46.936
	node_disk_read_bytes_total{device="sda"} 2.41414144e+08
	node_disk_read_time_seconds_total{device="sda"} 21.113
	node_disk_write_time_seconds_total{device="sda"} 117.513
	
				Network
	node_network_receive_errs_total{device="enp0s3"} 0
	node_network_receive_bytes_total{device="enp0s3"} 9.5060737e+07
	node_network_transmit_bytes_total{device="enp0s3"} 6.065389e+06
	node_network_transmit_errs_total
_________________________________________________________________________________________________________________________________________________________________________________
	
Задача 3

Установите в свою виртуальную машину Netdata. Воспользуйтесь готовыми пакетами для установки (sudo apt install -y netdata). После успешной установки:
в конфигурационном файле /etc/netdata/netdata.conf в секции [web] замените значение с localhost на bind to = 0.0.0.0,
добавьте в Vagrantfile проброс порта Netdata на свой локальный компьютер и сделайте vagrant reload:
config.vm.network "forwarded_port", guest: 19999, host: 19999
После успешной перезагрузки в браузере на своем ПК (не в виртуальной машине) вы должны суметь зайти на localhost:19999. Ознакомьтесь с метриками, которые по умолчанию собираются Netdata и с комментариями, которые даны к этим метрикам.

Ответ:

![image](https://user-images.githubusercontent.com/65549218/144397621-934ae404-18a4-4a3e-9299-edb9296571c2.png)

_________________________________________________________________________________________________________________________________________________________________________________

Задача 4

Можно ли по выводу dmesg понять, осознает ли ОС, что загружена не на настоящем оборудовании, а на системе виртуализации?

Ответ:

![image](https://user-images.githubusercontent.com/65549218/144398150-7fe5f166-6c18-4ccf-87e4-47d36e7bde45.png)

_________________________________________________________________________________________________________________________________________________________________________________

Задача 5

Как настроен sysctl fs.nr_open на системе по-умолчанию? Узнайте, что означает этот параметр. Какой другой существующий лимит не позволит достичь такого числа (ulimit --help)?

Ответ:

root@debian:/etc/systemd/system# /sbin/sysctl -n fs.nr_open
1048576

Это максимальное число открытых дескрипторов для ядра.

root@debian:/etc/systemd/system#  ulimit -Sn
1024

лимит на пользователя 

root@debian:/etc/systemd/system# ulimit -Hn
1048576

жесткий лимит на пользователя
_________________________________________________________________________________________________________________________________________________________________________________

Задача 6

Запустите любой долгоживущий процесс (не ls, который отработает мгновенно, а, например, sleep 1h) в отдельном неймспейсе процессов; покажите, что ваш процесс работает под PID 1 через nsenter. Для простоты работайте в данном задании под root (sudo -i). Под обычным пользователем требуются дополнительные опции (--map-root-user) и т.д.

Ответ:

![image](https://user-images.githubusercontent.com/65549218/144430196-0b9fe698-02ce-454a-ae16-c558e5c22ac2.png)

_________________________________________________________________________________________________________________________________________________________________________________

Задача 7

Найдите информацию о том, что такое :(){ :|:& };:. Запустите эту команду в своей виртуальной машине Vagrant с Ubuntu 20.04 (это важно, поведение в других ОС не проверялось). Некоторое время все будет "плохо", после чего (минуты) – ОС должна стабилизироваться. Вызов dmesg расскажет, какой механизм помог автоматической стабилизации. Как настроен этот механизм по-умолчанию, и как изменить число процессов, которое можно создать в сессии?

Ответ:

:(){ :|:& };: Определяет функцию с именем : , которая порождает саму себя.
Таким образом, каждый экземпляр : начинает два новых : и так далее... Как двоичное дерево процессов...
Вы можете предотвратить такие атаки, используя ulimit для ограничения количества processes-per-user:
$ ulimit -u 50


_________________________________________________________________________________________________________________________________________________________________________________
